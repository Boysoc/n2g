---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Sidebar from "@components/Sidebar.astro";
import getUniqueCategories from "@utils/getUniqueCategories";
import { SITE } from "@config";

const posts = await getCollection("blog");
const categories = getUniqueCategories(posts);

// 计算每个分类的文章数量
const categoriesWithCount = categories.map(({ category, categoryName }) => {
  const count = posts.filter(post => 
    post.data.categories.some(c => c === categoryName)
  ).length;
  return { category, categoryName, count };
});
---

<Layout title={`分类 | ${SITE.title}`}>
  <div class="side-click icon-arrow-down"></div>
  <div class="move-block">
    <Header />
    <div id="body">
      <div class="container">
        <div class="col-group">
          <div class="col-8" id="main">
            <div class="res-cons">
              <article class="post">
                <header>
                  <h1 class="post-title">分类</h1>
                </header>
                <div class="post-content">
                  <p>所有文章分类。</p>
                  
                  <div class="categories-list">
                    {categoriesWithCount.map(({ category, categoryName, count }) => (
                      <div class="category-item">
                        <h3>
                          <a href={`/categories/${category}`}>{categoryName}</a>
                          <span class="count">({count})</span>
                        </h3>
                      </div>
                    ))}
                  </div>
                </div>
              </article>
            </div>
          </div>
          <Sidebar />
        </div>
      </div>
    </div>
    <Footer />
  </div>
</Layout>

<style>
  .categories-list {
    margin: 20px 0;
  }
  
  .category-item {
    margin: 10px 0;
    padding: 10px;
    border-left: 3px solid #eeea07;
    background: #f9f9f9;
  }
  
  .category-item h3 {
    margin: 0;
    font-size: 16px;
  }
  
  .category-item a {
    color: #333;
    text-decoration: none;
  }
  
  .category-item a:hover {
    color: #666;
  }
  
  .count {
    color: #999;
    font-weight: normal;
    margin-left: 5px;
  }
</style>