---
export interface Props {
  title?: string;
  author?: string;
  description?: string;
  ogImage?: string;
  canonicalURL?: string;
  pubDatetime?: Date;
  modDatetime?: Date | null;
  scrollSmooth?: boolean;
}

const {
  title = "Xio's",
  author = "Xio",
  description = "ä¸€åˆ‡ä»ç®€ï¼Œè®°å½•ç”Ÿæ´»ã€‚",
  ogImage = "/assets/images/og-image.png",
  canonicalURL = new URL(Astro.url.pathname, Astro.site).href,
  pubDatetime,
  modDatetime,
  scrollSmooth = false,
} = Astro.props;

const socialImageURL = new URL(
  ogImage ?? "/assets/images/og-image.png",
  Astro.url.origin
).href;
---

<!doctype html>
<html lang="zh-cn" class={scrollSmooth ? "scroll-smooth" : ""}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />

    <!-- General Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="author" content={author} />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={socialImageURL} />

    <!-- Article Published/Modified time -->
    {
      pubDatetime && (
        <meta
          property="article:published_time"
          content={pubDatetime.toISOString()}
        />
      )
    }
    {
      modDatetime && (
        <meta
          property="article:modified_time"
          content={modDatetime.toISOString()}
        />
      )
    }

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={socialImageURL} />

    <!-- å¼•å…¥ Navy ä¸»é¢˜çš„æ ¸å¿ƒæ ·å¼ -->
    <link rel="stylesheet" href="/assets/normalize.min.css" />
    
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap"
      rel="stylesheet"
    />

    <meta name="theme-color" content="" />

    {
      // If PUBLIC_GOOGLE_SITE_VERIFICATION is set in the environment variable,
      // include google-site-verification tag in the heading
      // Learn more: https://support.google.com/webmasters/answer/9008080#meta_tag_verification&zippy=%2Chtml-tag
      import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION && (
        <meta
          name="google-site-verification"
          content={import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION}
        />
      )
    }

    <script is:inline src="/toggle-theme.js"></script>
    
    <!-- æ§åˆ¶å°è‡ªå®šä¹‰ä¿¡æ¯ -->
    <script is:inline>
      // æ§åˆ¶å°è‰ºæœ¯å­—å’Œä¿¡æ¯
      console.log('%c', 'font-size:1px; padding:100px 150px; background:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8dGV4dCB4PSIxNTAiIHk9IjEwMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjM2IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzMzMzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+bjJnLmNuPC90ZXh0Pgo8L3N2Zz4K") no-repeat;');
      
      console.log('%cğŸ‰ æ¬¢è¿æ¥åˆ° n2g.cnï¼', 'color: #ff6b6b; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);');
      
      console.log('%cğŸ“ ä¸€åˆ‡ä»ç®€ï¼Œè®°å½•ç”Ÿæ´»', 'color: #4ecdc4; font-size: 16px; font-style: italic;');
      
      console.log('%cğŸ’» å¦‚æœä½ æ˜¯å¼€å‘è€…ï¼Œæ¬¢è¿æŸ¥çœ‹æºç ï¼', 'color: #45b7d1; font-size: 14px;');
      
      console.log('%cğŸ” å‘ç°äº†ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿å—ï¼Ÿ', 'color: #96ceb4; font-size: 14px;');
      
      console.log('%cğŸ“§ è”ç³»æˆ‘: boysoc@qq.com', 'color: #feca57; font-size: 12px;');
      
      console.log('%câ­ GitHub: https://github.com/Boysoc', 'color: #ff9ff3; font-size: 12px;');
      
      console.log('%cğŸš€ Built with Astro & â¤ï¸', 'color: #54a0ff; font-size: 12px;');
      
      // æ·»åŠ ä¸€äº›äº¤äº’å¼åŠŸèƒ½
      console.log('%cğŸ® è¯•è¯•è¿™äº›å‘½ä»¤:', 'color: #5f27cd; font-size: 14px; font-weight: bold;');
      console.log('%c  â€¢ showInfo() - æ˜¾ç¤ºç½‘ç«™ä¿¡æ¯', 'color: #00d2d3; font-size: 12px;');
      console.log('%c  â€¢ showStats() - æ˜¾ç¤ºç½‘ç«™ç»Ÿè®¡', 'color: #00d2d3; font-size: 12px;');
      console.log('%c  â€¢ surprise() - ç»™ä½ ä¸€ä¸ªæƒŠå–œ', 'color: #00d2d3; font-size: 12px;');
      
      // å®šä¹‰ä¸€äº›æœ‰è¶£çš„å‡½æ•°
      window.showInfo = function() {
        console.log('%cğŸ“Š ç½‘ç«™ä¿¡æ¯:', 'color: #ff6b6b; font-size: 16px; font-weight: bold;');
        console.log('ğŸŒ åŸŸå: n2g.cn');
        console.log('ğŸ› ï¸ æŠ€æœ¯æ ˆ: Astro + TypeScript');
        console.log('ğŸ¨ ä¸»é¢˜: Navy (è‡ªå®šä¹‰)');
        console.log('ğŸ“± å“åº”å¼: æ”¯æŒ');
        console.log('ğŸ” SEO: ä¼˜åŒ–');
      };
      
      window.showStats = function() {
        const posts = document.querySelectorAll('.post').length;
        const links = document.querySelectorAll('a').length;
        const images = document.querySelectorAll('img').length;
        
        console.log('%cğŸ“ˆ é¡µé¢ç»Ÿè®¡:', 'color: #4ecdc4; font-size: 16px; font-weight: bold;');
        console.log(`ğŸ“ æ–‡ç« æ•°é‡: ${posts || 'åŠ è½½ä¸­...'}`);
        console.log(`ğŸ”— é“¾æ¥æ•°é‡: ${links}`);
        console.log(`ğŸ–¼ï¸ å›¾ç‰‡æ•°é‡: ${images}`);
        console.log(`â° è®¿é—®æ—¶é—´: ${new Date().toLocaleString('zh-CN')}`);
      };
      
      window.surprise = function() {
        const surprises = [
          'ğŸ‰ ä½ å‘ç°äº†ä¸€ä¸ªå½©è›‹ï¼',
          'ğŸ¦„ ç‹¬è§’å…½å‡ºç°äº†ï¼',
          'ğŸŒŸ ä½ è·å¾—äº†å¼€å‘è€…å¾½ç« ï¼',
          'ğŸ¯ æ­å–œä½ ï¼Œå¥½å¥‡å¿ƒæ»¡åˆ†ï¼',
          'ğŸš€ å‡†å¤‡èµ·é£ï¼',
          'ğŸ’ ä½ æ‰¾åˆ°äº†éšè—çš„å®çŸ³ï¼',
          'ğŸª æ¬¢è¿æ¥åˆ°ä»£ç é©¬æˆå›¢ï¼',
          'ğŸ­ ä½ æ­å¼€äº†ç¥ç§˜é¢çº±ï¼'
        ];
        const randomSurprise = surprises[Math.floor(Math.random() * surprises.length)];
        console.log(`%c${randomSurprise}`, 'color: #ff6b6b; font-size: 20px; font-weight: bold; animation: pulse 1s infinite;');
        
        // æ·»åŠ ä¸€äº›è§†è§‰æ•ˆæœ
        console.log('%cğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠ', 'color: #feca57; font-size: 16px;');
      };
      
      // æ£€æµ‹å¼€å‘è€…å·¥å…·æ‰“å¼€ - ä½¿ç”¨window resizeäº‹ä»¶
      let devtools = {open: false};
      const threshold = 160;
      
      // ä½¿ç”¨ window resize äº‹ä»¶æ›¿ä»£ ResizeObserver
      const checkDevTools = () => {
        const isDevToolsOpen = window.outerHeight - window.innerHeight > threshold || 
                               window.outerWidth - window.innerWidth > threshold;
        
        if (isDevToolsOpen && !devtools.open) {
          devtools.open = true;
          console.log('%cğŸ”§ æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·å·²æ‰“å¼€ï¼', 'color: #ff6b6b; font-size: 14px; font-weight: bold;');
          console.log('%cğŸ‘‹ Hello, Developer!', 'color: #4ecdc4; font-size: 12px;');
        } else if (!isDevToolsOpen && devtools.open) {
          devtools.open = false;
        }
      };
      
      // ç›‘å¬çª—å£å¤§å°å˜åŒ–
      window.addEventListener('resize', checkDevTools, { passive: true });
      
      // åˆå§‹æ£€æŸ¥
      checkDevTools();
      
      // æ·»åŠ ä¸€ä¸ªå°çš„ASCIIè‰ºæœ¯
      console.log(`
%c    â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
    â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â• 
    â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• 
                                
%c        ä¸€åˆ‡ä»ç®€ï¼Œè®°å½•ç”Ÿæ´»
      `, 'color: #45b7d1; font-family: monospace; font-size: 12px;', 'color: #96ceb4; font-size: 10px; font-style: italic;');
    </script>
  </head>
  <body>
    <slot />
    
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <div class="link-back2top" id="back2top" style="display: none;">
      <a href="#" title="å›åˆ°é¡¶éƒ¨"></a>
    </div>
    
    <!-- å…¨å±€ Sidebar æ§åˆ¶è„šæœ¬ -->
    <script is:inline>
      document.addEventListener('DOMContentLoaded', function() {
        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
        function isMobile() {
          return window.innerWidth <= 768;
        }
        
        // Sidebar æ§åˆ¶åŠŸèƒ½
        let winWidth = 0;
        
        function findDimensions() {
          if (window.innerWidth) {
            winWidth = window.innerWidth;
          } else if (document.body && document.body.clientWidth) {
            winWidth = document.body.clientWidth;
          }
          if (document.documentElement && document.documentElement.clientWidth) {
            winWidth = document.documentElement.clientWidth;
          }
        }
        
        findDimensions();
        
        function showHeadBlock() {
          const moveBlock = document.querySelector('.move-block');
          const secondary = document.querySelector('#secondary');
          const sideClick = document.querySelector('.side-click');
          
          if (isMobile()) {
            // ç§»åŠ¨ç«¯ï¼šå¼¹å‡º Sidebar
            if (secondary) {
              secondary.classList.add('show');
              document.body.style.overflow = 'hidden';
            }
          } else {
            // æ¡Œé¢ç«¯ï¼šæ»‘å…¥ Sidebar
            if (moveBlock && secondary) {
              if (winWidth > 1057) {
                moveBlock.style.marginLeft = '-330px';
              } else {
                moveBlock.style.left = '-330px';
              }
              secondary.style.right = '0';
            }
          }
          
          if (sideClick) {
            sideClick.classList.remove('icon-arrow-down');
            sideClick.classList.add('icon-cross');
          }
        }
        
        function hideHeadBlock() {
          const moveBlock = document.querySelector('.move-block');
          const secondary = document.querySelector('#secondary');
          const sideClick = document.querySelector('.side-click');
          
          if (isMobile()) {
            // ç§»åŠ¨ç«¯ï¼šéšè— Sidebar
            if (secondary) {
              secondary.classList.remove('show');
              document.body.style.overflow = '';
            }
          } else {
            // æ¡Œé¢ç«¯ï¼šæ»‘å‡º Sidebar
            if (moveBlock && secondary) {
              moveBlock.style.left = '0px';
              moveBlock.style.marginLeft = '0px';
              secondary.style.right = '-330px';
            }
          }
          
          if (sideClick) {
            sideClick.classList.remove('icon-cross');
            sideClick.classList.add('icon-arrow-down');
          }
        }
        
        // ä¾§è¾¹æ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('side-click')) {
            if (e.target.classList.contains('icon-arrow-down')) {
              showHeadBlock();
            } else if (e.target.classList.contains('icon-cross')) {
              hideHeadBlock();
            }
          }
        });
        
        // ç§»åŠ¨ç«¯é®ç½©å±‚ç‚¹å‡»å…³é—­
        const secondary = document.querySelector('#secondary');
        if (secondary) {
          secondary.addEventListener('click', function(e) {
            if (isMobile() && e.target === this) {
              hideHeadBlock();
            }
          });
        }
        
        // ESC é”®å…³é—­
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            const sideClick = document.querySelector('.side-click');
            if (sideClick && sideClick.classList.contains('icon-cross')) {
              hideHeadBlock();
            }
          }
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç½®çŠ¶æ€
        window.addEventListener('resize', function() {
          findDimensions();
          
          const secondary = document.querySelector('#secondary');
          const sideClick = document.querySelector('.side-click');
          const moveBlock = document.querySelector('.move-block');
          
          if (isMobile()) {
            // ç§»åŠ¨ç«¯ï¼šé‡ç½®æ¡Œé¢ç«¯æ ·å¼
            if (moveBlock) {
              moveBlock.style.left = '';
              moveBlock.style.marginLeft = '';
            }
            if (secondary) {
              secondary.style.right = '';
            }
          } else {
            // æ¡Œé¢ç«¯ï¼šé‡ç½®ç§»åŠ¨ç«¯æ ·å¼
            if (secondary) {
              secondary.classList.remove('show');
            }
            document.body.style.overflow = '';
          }
        });
      });
      
      // å›åˆ°é¡¶éƒ¨åŠŸèƒ½ - ä½¿ç”¨èŠ‚æµä¼˜åŒ–æ€§èƒ½
      const back2top = document.getElementById('back2top');
      const back2topLink = back2top?.querySelector('a');
      
      // èŠ‚æµå‡½æ•°
      function throttle(func, limit) {
        let inThrottle;
        return function() {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        }
      }
      
      // ç›‘å¬æ»šåŠ¨äº‹ä»¶ - ä½¿ç”¨èŠ‚æµä¼˜åŒ–æ€§èƒ½
      const handleScroll = throttle(function() {
        if (window.scrollY > 300) {
          back2top.style.display = 'block';
        } else {
          back2top.style.display = 'none';
        }
      }, 100);
      
      window.addEventListener('scroll', handleScroll, { passive: true });
      
      // ç‚¹å‡»å›åˆ°é¡¶éƒ¨
      back2topLink?.addEventListener('click', function(e) {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    </script>
  </body>
</html>

<style is:global>
  /* å¼•å…¥ Navy ä¸»é¢˜çš„å®Œæ•´æ ·å¼ */
  @import url('../styles/base.css');
  
  /* è°ƒæ•´æŒ‰é’®å¤§å°ä¸º 26x26px - è¦†ç›–æ‰€æœ‰å¯èƒ½çš„æ ·å¼ */
  .side-click {
    width: 26px !important;
    height: 26px !important;
    line-height: 26px !important;
    font-size: 16px !important;
    text-align: center !important;
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    background: white !important;
    border: 1px solid #333 !important;
    border-radius: 50% !important;
    cursor: pointer !important;
    z-index: 1000 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  
  /* ç§»åŠ¨ç«¯ä¿æŒç›¸åŒå¤§å° */
  @media (max-width: 768px) {
    .side-click {
      width: 26px !important;
      height: 26px !important;
      line-height: 26px !important;
      font-size: 16px !important;
      top: 15px !important;
      right: 15px !important;
    }
  }
</style>