---
---
<div class="waline-container">
  <div id="waline-comments"></div>
</div>

<style>
  .waline-container {
    margin: 2em 0;
    padding: 1em 0;
    border-top: 1px solid #ddd;
  }
</style>

<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 加载 Waline UMD 版本
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/@waline/client@v3/dist/waline.umd.js';
    script.onload = function() {
      // 使用全局 Waline 对象
      window.Waline.init({
        el: '#waline-comments',
        serverURL: 'https://tencent.n2g.cn/',
        // 手动添加末尾斜杠，确保与评论数据匹配
        path: window.location.pathname + '/',
        lang: 'zh-CN',
        avatar: 'qq', // 启用QQ头像，当用户使用QQ邮箱时会自动获取QQ头像
        locale: {
          placeholder: '请留下你的足迹~（使用QQ邮箱可显示QQ头像）',
          sofa: '快来做第一个评论的人吧~',
          submit: '提交',
          reply: '回复',
          cancelReply: '取消回复',
          comment: '评论',
          refresh: '刷新',
          more: '加载更多...',
          preview: '预览',
          emoji: '表情',
          uploadImage: '上传图片'
        },
        // 自定义时间格式化函数
        formatTime: function(date) {
          const d = new Date(date);
          const year = d.getFullYear();
          const month = String(d.getMonth() + 1).padStart(2, '0');
          const day = String(d.getDate()).padStart(2, '0');
          const hours = String(d.getHours()).padStart(2, '0');
          const minutes = String(d.getMinutes()).padStart(2, '0');
          const seconds = String(d.getSeconds()).padStart(2, '0');
          return `${year}年${month}月${day}日 ${hours}:${minutes}:${seconds}`;
        },
        emoji: [
          'https://unpkg.com/@waline/emojis@1.2.0/qq'
        ], // 使用官方 QQ 表情包，不包含 GIF
        dark: 'auto',
        meta: ['nick', 'mail', 'link'],
        requiredMeta: ['nick'],
        pageSize: 10,
        wordLimit: [0, 1000],
        imageUploader: false,
        highlight: true, // 支持 Markdown 代码高亮
        mathTagSupport: false,
        commentSorting: 'latest',
        search: false,
        reaction: false,
        copyright: false,
        login: 'disable'
      });
    };
    script.onerror = function() {
      console.error('Waline 加载失败');
      document.getElementById('waline-comments').innerHTML = '<p style="text-align: center; color: #999;">评论系统加载失败，请刷新页面重试</p>';
    };
    document.head.appendChild(script);
  });
</script>